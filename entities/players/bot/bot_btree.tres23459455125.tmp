[gd_resource type="BehaviorTree" load_steps=38 format=3 uid="uid://cbde2ehtgcqxi"]

[ext_resource type="Script" uid="uid://3n3bjyugu0bw" path="res://ai/tasks/movement/set_random_player.gd" id="1_5gtbw"]
[ext_resource type="Script" uid="uid://bb6hh84nj8lt7" path="res://ai/tasks/movement/collect_pu.gd" id="1_d1gdq"]
[ext_resource type="Script" uid="uid://tegi1fnnriit" path="res://ai/tasks/stats/is_health_lq.gd" id="1_ud1v2"]
[ext_resource type="Script" uid="uid://bqc0re08uiclu" path="res://ai/tasks/movement/is_distance_lessthan.gd" id="2_ohgi5"]
[ext_resource type="Script" uid="uid://b7msvgo0to61n" path="res://ai/tasks/shooting/check_retaliation.gd" id="2_xgtuf"]
[ext_resource type="Script" uid="uid://cqypksh7kuvfk" path="res://ai/tasks/movement/chase.gd" id="3_xgtuf"]
[ext_resource type="Script" uid="uid://c5jkec1b05ilt" path="res://ai/tasks/movement/strafe.gd" id="4_d1gdq"]
[ext_resource type="Script" uid="uid://dc25d1qg46j07" path="res://ai/tasks/movement/runaway.gd" id="4_ohgi5"]
[ext_resource type="Script" uid="uid://dycpg5phc4c" path="res://ai/tasks/shooting/aim_relative_at.gd" id="5_ud1v2"]

[sub_resource type="BlackboardPlan" id="BlackboardPlan_8wdlt"]
var/target/name = &"target"
var/target/type = 24
var/target/hint = 34
var/target/hint_string = "Who to follow"
var/latest_aggressor/name = &"latest_aggressor"
var/latest_aggressor/type = 24
var/latest_aggressor/hint = 34
var/latest_aggressor/hint_string = "Who did hit lastly"
var/last_hit_time/name = &"last_hit_time"
var/last_hit_time/type = 3
var/last_hit_time/value = 0.0
var/last_hit_time/hint = 0
var/last_hit_time/hint_string = "When did `latest_aggressor` hit"
var/target_powerup/name = &"target_powerup"
var/target_powerup/type = 24
var/target_powerup/hint = 34
var/target_powerup/hint_string = "What powerup are we targetting"

[sub_resource type="BTAction" id="BTAction_jgilv"]
script = ExtResource("1_ud1v2")

[sub_resource type="BTAction" id="BTAction_y6ovw"]
script = ExtResource("1_d1gdq")

[sub_resource type="BTSequence" id="BTSequence_y6ovw"]
custom_name = "Find health if life state is critical"
children = [SubResource("BTAction_jgilv"), SubResource("BTAction_y6ovw")]

[sub_resource type="BTComment" id="BTComment_ohgi5"]
custom_name = "This will be used to set the current target. The logic is, if current target=null, find another"

[sub_resource type="BTAction" id="BTAction_y1gc2"]
children = [SubResource("BTComment_ohgi5")]
script = ExtResource("1_5gtbw")

[sub_resource type="BTAction" id="BTAction_ud1v2"]
script = ExtResource("2_xgtuf")
compare_hp = true

[sub_resource type="BTCondition" id="BTCondition_5gtbw"]
script = ExtResource("2_ohgi5")
distance_var = 10.0

[sub_resource type="BTInvert" id="BTInvert_y1gc2"]
children = [SubResource("BTCondition_5gtbw")]

[sub_resource type="BTAction" id="BTAction_ror5h"]
script = ExtResource("3_xgtuf")

[sub_resource type="BTSequence" id="BTSequence_xgtuf"]
custom_name = "Chase if far"
children = [SubResource("BTInvert_y1gc2"), SubResource("BTAction_ror5h")]

[sub_resource type="BTAction" id="BTAction_ho6qd"]
script = ExtResource("5_ud1v2")

[sub_resource type="BBNode" id="BBNode_y6ovw"]
saved_value = NodePath(".")
resource_name = "."

[sub_resource type="BTCallMethod" id="BTCallMethod_jgilv"]
node = SubResource("BBNode_y6ovw")
method = &"cmd_on_target_shoot"

[sub_resource type="BTSequence" id="BTSequence_oprq4"]
custom_name = "Shoot"
children = [SubResource("BTAction_ho6qd"), SubResource("BTCallMethod_jgilv")]

[sub_resource type="BTParallel" id="BTParallel_xgtuf"]
custom_name = "Chase and Shoot"
children = [SubResource("BTSequence_xgtuf"), SubResource("BTSequence_oprq4")]

[sub_resource type="BTCondition" id="BTCondition_xgtuf"]
script = ExtResource("2_ohgi5")
distance_var = 5.0

[sub_resource type="BTAction" id="BTAction_d1gdq"]
script = ExtResource("4_ohgi5")

[sub_resource type="BTSequence" id="BTSequence_ud1v2"]
custom_name = "Run away logic"
children = [SubResource("BTCondition_xgtuf"), SubResource("BTAction_d1gdq")]

[sub_resource type="BTAction" id="BTAction_5gtbw"]
script = ExtResource("4_d1gdq")

[sub_resource type="BTSelector" id="BTSelector_ho6qd"]
children = [SubResource("BTSequence_ud1v2"), SubResource("BTAction_5gtbw")]

[sub_resource type="BTAction" id="BTAction_ohgi5"]
script = ExtResource("5_ud1v2")

[sub_resource type="BBNode" id="BBNode_ajhej"]
saved_value = NodePath(".")
resource_name = "."

[sub_resource type="BTCallMethod" id="BTCallMethod_5gtbw"]
node = SubResource("BBNode_ajhej")
method = &"cmd_shoot"

[sub_resource type="BTSequence" id="BTSequence_5gtbw"]
children = [SubResource("BTAction_ohgi5"), SubResource("BTCallMethod_5gtbw")]

[sub_resource type="BTParallel" id="BTParallel_ajhej"]
custom_name = "Shoot if closer"
children = [SubResource("BTSelector_ho6qd"), SubResource("BTSequence_5gtbw")]

[sub_resource type="BTSelector" id="BTSelector_y1gc2"]
custom_name = "Chase OR shoot based on distance"
children = [SubResource("BTAction_ud1v2"), SubResource("BTParallel_xgtuf"), SubResource("BTParallel_ajhej")]

[sub_resource type="BTSequence" id="BTSequence_ho6qd"]
children = [SubResource("BTSequence_y6ovw"), SubResource("BTAction_y1gc2"), SubResource("BTSelector_y1gc2")]

[resource]
blackboard_plan = SubResource("BlackboardPlan_8wdlt")
root_task = SubResource("BTSequence_ho6qd")
